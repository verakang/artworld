import{P as M}from"./PaginationComponent-15c9ee95.js";import{m as C}from"./modalMixin-176ec355.js";import{_ as T,r as h,o as n,c,d as a,w as A,b as t,t as v,n as _,g as x,B as V,G as k,e as g,F as $,z as D}from"./index-63b9cbb2.js";import{S as u}from"./sweetalert2.all-517d81ab.js";import"./base-component-1b447db8.js";const B={data(){return{modal:"",articleTemp:{}}},mixins:[C],props:{article:{type:Object,default(){return{}},isNew:{type:Boolean,default:!1}},isDone:{type:Boolean,default:!0},updateTitle:{type:String},updateArticle:{type:Function}},watch:{article(){this.articleTemp=this.article,this.articleTemp.create_at=Math.floor(Date.now()/1e3)}}},P={ref:"modal",id:"articleModal",class:"modal fade",tabindex:"-1"},L={class:"modal-content border-0"},U={class:"modal-header bg-dark text-white"},N={id:"articleModalLabel",class:"modal-title"},S=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),E={class:"modal-body"},H={class:"row"},R={class:"col-sm-4"},Y={class:"mb-2"},q={class:"mb-3"},F=t("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),I=["src"],O={class:"col-sm-8"},j={class:"mb-3"},G=t("label",{for:"title",class:"form-label"},[g("標題"),t("span",{class:"text-danger"}," *")],-1),z={class:"row"},W={class:"mb-3 col-md-6"},J=t("label",{for:"description",class:"form-label"},"文章分類",-1),K={class:"mb-3 col-md-6"},Q=t("label",{for:"author",class:"form-label"},[g("作者"),t("span",{class:"text-danger"}," *")],-1),X={class:"mb-3"},Z=t("label",{for:"content",class:"form-label"},[g("文章內容"),t("span",{class:"text-danger"}," *")],-1),tt={class:"mb-3"},et={class:"form-check"},st=t("label",{class:"form-check-label me-3",for:"isPublic"},"是否啟用",-1),ot={key:0,class:"badge bg-success"},lt={key:1,class:"badge bg-danger"},it={class:"modal-footer"},at=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function rt(o,e,l,y,s,m){const d=h("v-field"),p=h("error-message"),w=h("v-form");return n(),c("div",P,[a(w,{class:"modal-dialog modal-xl",onSubmit:l.updateArticle},{default:A(({errors:i})=>[t("div",L,[t("div",U,[t("h5",N,[t("span",null,v(l.updateTitle),1)]),S]),t("div",E,[t("div",H,[t("div",R,[t("div",Y,[t("div",q,[F,a(d,{type:"text",name:"圖片網址",class:_(["form-control",{"is-invalid":i.圖片網址}]),placeholder:"請輸入圖片連結",rules:"url",modelValue:s.articleTemp.image,"onUpdate:modelValue":e[0]||(e[0]=r=>s.articleTemp.image=r)},null,8,["class","modelValue"]),a(p,{name:"圖片網址",class:"invalid-feedback"})]),t("img",{class:"img-fluid",src:s.articleTemp.image,alt:"文章圖片"},null,8,I)])]),t("div",O,[t("div",j,[G,a(d,{id:"title",name:"標題",type:"text",class:_(["form-control",{"is-invalid":i.標題}]),placeholder:"請輸入標題",rules:"required",modelValue:s.articleTemp.title,"onUpdate:modelValue":e[1]||(e[1]=r=>s.articleTemp.title=r)},null,8,["class","modelValue"]),a(p,{name:"標題",class:"invalid-feedback"})]),t("div",z,[t("div",W,[J,x(t("input",{id:"description",type:"text",class:"form-control",placeholder:"請輸入文章分類","onUpdate:modelValue":e[2]||(e[2]=r=>s.articleTemp.description=r)},null,512),[[V,s.articleTemp.description]])]),t("div",K,[Q,a(d,{id:"author",name:"作者",type:"text",class:_(["form-control",{"is-invalid":i.作者}]),placeholder:"請輸入單位",rules:"required",modelValue:s.articleTemp.author,"onUpdate:modelValue":e[3]||(e[3]=r=>s.articleTemp.author=r)},null,8,["class","modelValue"]),a(p,{name:"作者",class:"invalid-feedback"})])]),t("div",X,[Z,a(d,{as:"textarea",id:"content",name:"文章內容",type:"text",class:_(["form-control",{"is-invalid":i.文章內容}]),style:{"min-height":"120px"},placeholder:"請輸入文章內容",rules:"required",modelValue:s.articleTemp.content,"onUpdate:modelValue":e[4]||(e[4]=r=>s.articleTemp.content=r)},null,8,["class","modelValue"]),a(p,{name:"文章內容",class:"invalid-feedback"})]),t("div",tt,[t("div",et,[x(t("input",{id:"isPublic",class:"form-check-input",type:"checkbox","true-value":!0,"false-value":!1,"onUpdate:modelValue":e[5]||(e[5]=r=>s.articleTemp.isPublic=r)},null,512),[[k,s.articleTemp.isPublic]]),st,s.articleTemp.isPublic?(n(),c("span",ot,"已啟用")):(n(),c("span",lt,"未啟用"))])])])])]),t("div",it,[at,t("button",{type:"submit",class:_(["btn btn-primary",{disabled:l.isDone===!1}])}," 確認 ",2)])])]),_:1},8,["onSubmit"])],512)}const nt=T(B,[["render",rt]]),ct={data(){return{modal:"",articleTemp:{}}},mixins:[C],props:{article:{type:Object,default(){return{}}},removeArticle:{type:Function}},watch:{article(){this.articleTemp=this.article}}},dt={ref:"modal",id:"delArticle",class:"modal fade",tabindex:"-1"},mt={class:"modal-dialog"},pt={class:"modal-content border-0"},ut=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delArticleModalLabel",class:"modal-title"},[t("span",null,"刪除文章")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ht={class:"modal-body"},_t={class:"text-danger"},bt={class:"modal-footer"},ft=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function gt(o,e,l,y,s,m){return n(),c("div",dt,[t("div",mt,[t("div",pt,[ut,t("div",ht,[g(" 是否刪除文章 "),t("strong",_t,v(s.articleTemp.title),1),g(" (刪除後將無法恢復)。 ")]),t("div",bt,[ft,t("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=(...d)=>l.removeArticle&&l.removeArticle(...d))}," 確認刪除 ")])])])],512)}const vt=T(ct,[["render",gt]]),{VITE_URL:b,VITE_PATH:f}={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"artworld",BASE_URL:"/artworld/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},wt={data(){return{articles:[],articleTemp:{},isNew:!1,updateTitle:"新增文章",page:{},isLoading:!1,isDone:!0}},components:{Pagination:M,ArticleModal:nt,DelArticle:vt},methods:{getData(){const o=`${b}/v2/api/${f}/admin/articles`;this.$http.get(o).then(e=>{this.articles=e.data.articles,this.page=e.data.pagination,this.isLoading=!1}).catch(e=>{u.fire({position:"top-end",icon:"error",color:"white",iconColor:"white",customClass:{popup:"colored-toast"},title:`${e.response.data.message}`,showConfirmButton:!1,timer:1e3,timerProgressBar:!0,toast:!0})})},getArticle(o){const e=`${b}/v2/api/${f}/admin/article/${o}`;this.$http.get(e).then(l=>{this.articleTemp=l.data.article,this.isLoading=!1}).catch(l=>{u.fire({position:"top-end",icon:"error",color:"white",iconColor:"white",customClass:{popup:"colored-toast"},title:`${l.response.data.message}`,showConfirmButton:!1,timer:1e3,timerProgressBar:!0,toast:!0})})},openModal(o,e){o==="create"?(this.updateTitle="新增文章",this.$refs.articleModal.openModal(),this.isNew=!0,this.articleTemp={},this.articleTemp.isPublic=!1,this.articleTemp.image="https://images.unsplash.com/photo-1509909756405-be0199881695?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1470&q=80"):o==="edit"?(this.updateTitle="編輯文章",this.$refs.articleModal.openModal(),this.isNew=!1,this.getArticle(e)):o==="delete"&&(this.$refs.delArticle.openModal(),this.getArticle(e))},updateArticle(){this.isDone=!1;let o=`${b}/v2/api/${f}/admin/article`,e="post";this.isNew||(o=`${b}/v2/api/${f}/admin/article/${this.articleTemp.id}`,e="put"),this.$http[e](o,{data:this.articleTemp}).then(l=>{this.isDone=!0,u.fire({position:"top-end",icon:"success",color:"white",iconColor:"white",customClass:{popup:"colored-toast"},title:`${l.data.message}`,showConfirmButton:!1,timer:1e3,timerProgressBar:!0,toast:!0}),this.getData(),this.$refs.articleModal.hideModal()}).catch(l=>{u.fire({position:"top-end",icon:"error",color:"white",iconColor:"white",customClass:{popup:"colored-toast"},title:`${l.response.data.message}`,showConfirmButton:!1,timer:1e3,timerProgressBar:!0,toast:!0})})},removeArticle(){const o=`${b}/v2/api/${f}/admin/article/${this.articleTemp.id}`;this.$http.delete(o).then(e=>{u.fire({position:"top-end",icon:"success",color:"white",iconColor:"white",customClass:{popup:"colored-toast"},title:`${e.data.message}`,showConfirmButton:!1,timer:1e3,timerProgressBar:!0,toast:!0}),this.getData(),this.$refs.delArticle.hideModal()}).catch(e=>{u.fire({position:"top-end",icon:"error",color:"white",iconColor:"white",customClass:{popup:"colored-toast"},title:`${e.response.data.message}`,showConfirmButton:!1,timer:1e3,timerProgressBar:!0,toast:!0})})}},mounted(){this.isLoading=!0,this.getData()}},Tt={class:"container py-4"},yt=t("h3",{class:"my-4"},"最新消息頁面",-1),xt={class:"text-end mt-4"},$t={class:"table-responsive"},Ct={class:"admin_table table table-hover mt-4"},Mt=t("thead",{class:"table-light"},[t("tr",null,[t("th",{width:"120"}," 日期 "),t("th",null,"標題"),t("th",{width:"100"}," 是否啟用 "),t("th",{width:"120"}," 編輯 ")])],-1),At={key:0,class:"text-success"},Vt={key:1},kt={class:"btn-group"},Dt=["onClick"],Bt=["onClick"];function Pt(o,e,l,y,s,m){const d=h("VueLoading"),p=h("ArticleModal"),w=h("DelArticle");return n(),c($,null,[a(d,{active:s.isLoading,"onUpdate:active":e[0]||(e[0]=i=>s.isLoading=i)},null,8,["active"]),t("div",Tt,[yt,t("div",xt,[t("button",{type:"button",class:"btn btn-primary",onClick:e[1]||(e[1]=()=>m.openModal("create"))}," 建立新的文章 ")]),t("div",$t,[t("table",Ct,[Mt,t("tbody",null,[(n(!0),c($,null,D(s.articles,i=>(n(),c("tr",{key:i.id},[t("td",null,v(o.$moment(new Date(i.create_at*1e3)).format("YYYY-MM-DD")),1),t("td",null,v(i.title),1),t("td",null,[i.isPublic?(n(),c("span",At,"啟用")):(n(),c("span",Vt,"未啟用"))]),t("td",null,[t("div",kt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:()=>m.openModal("edit",i.id)}," 編輯 ",8,Dt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:()=>m.openModal("delete",i.id)}," 刪除 ",8,Bt)])])]))),128))])])]),a(p,{ref:"articleModal",article:s.articleTemp,"update-article":m.updateArticle,"update-title":s.updateTitle},null,8,["article","update-article","update-title"]),a(w,{ref:"delArticle",article:s.articleTemp,"remove-article":m.removeArticle},null,8,["article","remove-article"])])],64)}const Ht=T(wt,[["render",Pt]]);export{Ht as default};
